{% extends "adminlte/common_tab_list.html" %}
{% load static %}

{% block header_base_style %}
  <link rel="stylesheet" href="{% static 'plugins/iCheck/square/blue.css' %}">
{% endblock %}

{% block common_list_buttons %}
  {% if page_model_perms.add %}
    <a class="btn btn-primary" id="create">
      <i class="fa fa-plus"></i> 新订单
    </a>
  {% endif %}
  {% if page_model_perms.delete %}
    <a class="btn btn-danger hidden-sm hidden-xs" v-on:click="removeSelected">
      <i class="fa fa-trash-o"></i> 删除
    </a>
  {% endif %}
{% endblock %}

{% block tab_nav %}
  <ul class="nav nav-tabs">
    <li data-status="CREATED" class="active">
      <a data-toggle="tab" href="#pane-CREATED"> 未完成</a>
    </li>
    <li data-status="ONGOING">
      <a data-toggle="tab" href="#pane-ONGOING"> 在途中</a>
    </li>
    <li data-status="FINISHED">
      <a data-toggle="tab" href="#pane-FINISHED"> 已完成</a>
    </li>
  </ul>
{% endblock %}

{% block tab_content %}
  <div class="tab-content">
    <div class="tab-pane" id="pane-ONGOING">
      <table class="table table-hover" data-status="ONGOING">
        <thead>
        <tr>
          <th class="text-center hidden-sm hidden-xs" style="width:60px;">
            <input type="checkbox" name="checkboxAllRow" class="checkboxAllRow" v-on:click="toggleAllBox"/>
          </th>
          <th class="visible-sm visible-xs" id="show_all_detail" style="width:50px;" v-on:click="show_all_detail">
            <i class="fa fa-plus-square text-muted" aria-hidden="true"></i>
          </th>
          <th>Date</th>
          <th>Name</th>
          <th>Status</th>
          <th>Price</th>
          <th class="hidden-sm hidden-xs">Ship</th>
          <th class="hidden-sm hidden-xs"></th>
        </tr>
        </thead>
        <tfoot>
        <tr>
        </tr>
        </tfoot>
        <tbody v-for="item in ongoing_items">
        <tr v-on:click="show_detail(item.id, $event)" data-pk="{!! item.id !!}">
          <td class="text-center hidden-sm hidden-xs">
            <input type="checkbox" class="minimal" name="checkboxRow" value="#[item.id]" />
          </td>
          <td class="visible-sm visible-xs show_detail" data-pk="{!! item.id !!}">
            <i class="fa fa-plus-square text-primary" aria-hidden="true"></i>
          </td>
          <td>
            <a target="_blank" href="{!! item.detail_url !!}">{!! item.create_time !!}</a>
          </td>
          <td>
            <a href="{!! item.customer_url !!}">{!! item.customer_display !!}</a>
          </td>
          <td>
            <template v-if="item.status == 'CREATED'">
              <a class="label label-info" v-on:click="next_ship_status(item.id,item.next_status,'在途', $event)">新建</a>
            </template>
            <template v-if="item.status == 'SHIPPING'">
              <a class="label label-success" v-on:click="next_ship_status(item.id,item.next_status,'寄达', $event)">在途</a>
            </template>
            <template v-if="item.status == 'DELIVERED'">
              <a class="label label-warning" v-on:click="next_ship_status(item.id,item.next_status,'完成', $event)">寄达</a>
            </template>
            <template v-if="item.status == 'FINISHED'">
              <a class="label label-danger" v-on:click="next_ship_status(item.id,item.next_status,'寄达', $event)">完成</a>
            </template>
          </td>
          <td class="hidden-sm hidden-xs">
            AUD:{!! item.product_cost_aud !!} + {!! item.shipping_fee !!} = {!! item.total_cost_aud !!}<br/>
            RMB:
            <template v-if="item.origin_sell_rmb == item.sell_price_rmb">
              {!! item.sell_price_rmb !!}
            </template>
            <template v-else>
              [{!! item.origin_sell_rmb !!}] {!! item.sell_price_rmb !!}
            </template>
            - {!! item.total_cost_rmb !!} = {!! item.profit_rmb !!}
            <template v-if="item.is_paid">
            </template>
            <template v-else>
              <a class="label-as-badge label label-danger pay" v-on:click="pay(item.id, $event)">
                <i class="fa fa-jpy"></i>
              </a>
            </template>
          </td>
          <td class="visible-sm visible-xs">
            <a href="{!! item.edit_url !!}#orderproduct">{!! item.sell_price_rmb !!}</a>
            <template v-if="item.is_paid">
            </template>
            <template v-else>
              <a class="label-as-badge label label-danger pull-right pay" v-on:click="pay(item.id, $event)">
                <i class="fa fa-jpy" aria-hidden="true"></i>
              </a>
            </template>
          </td>
          <td class="hidden-sm hidden-xs">
            {!! item.shipping_order !!}
          </td>

          {% block item_buttons %}
            {{ block.super }}
          {% endblock %}
        </tr>
        <tr class="hide" id="detail_{!! item.id !!}">
          <td colspan="4" class="hidden-sm hidden-xs"></td>
          <td colspan="100%">
            <div>{!! item.address_display !!}</div>
            <div class="pull-left">
                <template v-for="product in item.products">
                    <span>
                        <template v-if="item.status == 'CREATED'">
                            <input type="checkbox" v-on:click="makr_as_purchased($event)" checked="#[product.is_purchased]" name="markPurchased" value="#[product.id]" />
                        </template>
                        {!! product.name !!}x{!! product.amount !!}
                    </span><br/>
                  </template>
            </div>
            <div class="pull-right visible-sm visible-xs">
              {!! item.shipping_order !!}
            </div>
          </td>
        </tr>
        </tbody>
      </table>

      <div class="form-inline" align="center">
        <ul class="pagination pagination-sm no-margin form-group">
          <li v-if="ongoing_currentPage-2 > 1">
            <a href="javascript:void(0);" page="1" v-on:click="page_ongoing" class="text-bold" title="第1页">首页</a>
          </li>
          <li v-if="ongoing_currentPage > 1">
              <template v-for="n in 2">
                <a v-if="ongoing_currentPage-2+n > 0" href="javascript:void(0);" page="#[ongoing_currentPage-2+n]" style="width: 45px"
                   title="第#[ongoing_currentPage-2+n]页" v-on:click="page_ongoing" class="text-bold">#[ongoing_currentPage-2+n]</a>
              </template>
          </li>
          <li v-on:click="reload" class="disabled">
            <a style="width: 45px" href="javascript:void(0);">#[ongoing_currentPage]</a>
          </li>
          <li v-if="ongoing_currentPage < ongoing_totalPage">
            <template v-for="n in 2">
                <a v-if="ongoing_currentPage+n+1 <=ongoing_totalPage" href="javascript:void(0);" page="#[ongoing_currentPage+n+1]" style="width: 45px"
                   title="第#[ongoing_currentPage+n+1]页" v-on:click="page_ongoing" class="text-bold">#[ongoing_currentPage+n+1]</a>
            </template>
          </li>
          <li v-if="ongoing_currentPage+2 < ongoing_totalPage">
            <a href="javascript:void(0);" page="#[ongoing_totalPage]" v-on:click="page_ongoing" title="第#[ongoing_totalPage]页"
              class="text-bold">末页</a>
          </li>
        </ul>
        <div class="form-group">
            &nbsp;&nbsp;&nbsp;共 #[ongoing_count] 条数据, 每页 #[ongoing_perPage] 条, 第 #[ongoing_currentPage]/#[ongoing_totalPage] 页
        </div>
      </div>
      <br/>
    </div>

    <div class="tab-pane active" id="pane-CREATED">
      <table class="table table-hover" data-status="CREATED">
        <thead>
        <tr>
          <th class="text-center hidden-sm hidden-xs" style="width:60px;">
            <input type="checkbox" name="checkboxAllRow" class="checkboxAllRow" v-on:click="toggleAllBox"/>
          </th>
          <th class="visible-sm visible-xs" id="show_all_detail" style="width:50px;" v-on:click="show_all_detail">
            <i class="fa fa-plus-square text-muted" aria-hidden="true"></i>
          </th>
          <th>Date</th>
          <th>Name</th>
          <th>Status</th>
          <th>Price</th>
          <th class="hidden-sm hidden-xs">Ship</th>
          <th class="hidden-sm hidden-xs"></th>
        </tr>
        </thead>
        <tfoot>
        <tr>
        </tr>
        </tfoot>
        <tbody v-for="item in created_items">
        <tr v-on:click="show_detail(item.id, $event)" data-pk="{!! item.id !!}">
          <td class="text-center hidden-sm hidden-xs">
            <input type="checkbox" class="minimal" name="checkboxRow" value="#[item.id]" />
          </td>
          <td class="visible-sm visible-xs show_detail" data-pk="{!! item.id !!}">
            <i class="fa fa-plus-square text-primary" aria-hidden="true"></i>
          </td>
          <td>
            <a target="_blank" href="{!! item.detail_url !!}">{!! item.create_time !!}</a>
          </td>
          <td>
            <a href="{!! item.customer_url !!}">{!! item.customer_display !!}</a>
          </td>
          <td>
            <template v-if="item.status == 'CREATED'">
              <a class="label label-info" v-on:click="next_ship_status(item.id,item.next_status,'在途', $event)">新建</a>
            </template>
            <template v-if="item.status == 'SHIPPING'">
              <a class="label label-success" v-on:click="next_ship_status(item.id,item.next_status,'寄达', $event)">在途</a>
            </template>
            <template v-if="item.status == 'DELIVERED'">
              <a class="label label-warning" v-on:click="next_ship_status(item.id,item.next_status,'完成', $event)">寄达</a>
            </template>
            <template v-if="item.status == 'FINISHED'">
              <a class="label label-danger" v-on:click="next_ship_status(item.id,item.next_status,'寄达', $event)">完成</a>
            </template>
          </td>
          <td class="hidden-sm hidden-xs">
            AUD:{!! item.product_cost_aud !!} + {!! item.shipping_fee !!} = {!! item.total_cost_aud !!}<br/>
            RMB:
            <template v-if="item.origin_sell_rmb == item.sell_price_rmb">
              {!! item.sell_price_rmb !!}
            </template>
            <template v-else>
              [{!! item.origin_sell_rmb !!}] {!! item.sell_price_rmb !!}
            </template>
            - {!! item.total_cost_rmb !!} = {!! item.profit_rmb !!}
            <template v-if="item.is_paid">
            </template>
            <template v-else>
              <a class="label-as-badge label label-danger pay" v-on:click="pay(item.id, $event)">
                <i class="fa fa-jpy"></i>
              </a>
            </template>
          </td>
          <td class="visible-sm visible-xs">
            <a href="{!! item.edit_url !!}#orderproduct">{!! item.sell_price_rmb !!}</a>
            <template v-if="item.is_paid">
            </template>
            <template v-else>
              <a class="label-as-badge label label-danger pull-right pay" v-on:click="pay(item.id, $event)">
                <i class="fa fa-jpy" aria-hidden="true"></i>
              </a>
            </template>

              <button type="button" data-toggle="modal" data-target="#add-product" class="label-as-badge label label-success pull-right">
                <i class="fa fa-cart-plus fa-inverse"></i>
              </button>
              <button type="button" data-toggle="modal" data-target="#add-parcel" class="label-as-badge label label-info pull-right">
                <i class="fa fa-truck fa-inverse"></i>
              </button>
          </td>
          <td class="hidden-sm hidden-xs">
            {!! item.shipping_order !!}
          </td>

          <td class="text-right hidden-sm hidden-xs">
                {% if page_model_perms.change %}
                  <button type="button" data-toggle="modal" data-target="#add-product" class="btn btn-success btn-sm">
                    <i class="fa fa-lg fa-cart-plus fa-inverse"></i>
                  </button>
                  <button type="button" data-toggle="modal" data-target="#add-parcel" class="btn btn-info btn-sm">
                    <i class="fa fa-lg fa-truck fa-inverse"></i>
                  </button>
                {% endif %}

                {% if page_model_perms.change %}
                <a data-toggle="tooltip" data-placement="bottom" data-original-title="Edit" href="#[item.edit_url]" class="btn btn-primary btn-sm">
                    <i class="fa fa-lg fa-pencil fa-inverse"></i>
                </a>
                {% endif %}
                {% if page_model_perms.delete %}
                <a data-toggle="tooltip" data-placement="bottom" data-original-title="Delete" data-pk="#[item.id]" v-on:click="removeOne" href="javascript:void(0);" class="btn btn-danger btn-sm">
                    <i class="fa fa-lg fa-trash-o fa-inverse"></i>
                </a>
                {% endif %}
            </td>
        </tr>
        <tr class="hide" id="detail_{!! item.id !!}">
          <td colspan="4" class="hidden-sm hidden-xs"></td>
          <td colspan="100%">
            <div>
                {!! item.address_display !!}
            </div>
            <div class="pull-left">
                <template v-for="product in item.products">
                    <span>
                        <template v-if="item.status == 'CREATED'">
                            <input type="checkbox" v-on:click="makr_as_purchased($event)" checked="#[product.is_purchased]" name="markPurchased" value="#[product.id]" />
                        </template>
                        {!! product.name !!}x{!! product.amount !!}
                    </span><br/>
                  </template>
            </div>
            <div class="pull-right visible-sm visible-xs">
              {!! item.shipping_order !!}
            </div>
          </td>
        </tr>
        </tbody>
      </table>

      <div class="form-inline" align="center">
        <ul class="pagination pagination-sm no-margin form-group">
          <li v-if="created_currentPage-2 > 1">
            <a href="javascript:void(0);" page="1" v-on:click="page_created" class="text-bold" title="第1页">首页</a>
          </li>
          <li v-if="created_currentPage > 1">
              <template v-for="n in 2">
                <a v-if="created_currentPage-2+n > 0" href="javascript:void(0);" page="#[created_currentPage-2+n]" style="width: 45px"
                   title="第#[created_currentPage-2+n]页" v-on:click="page_created" class="text-bold">#[created_currentPage-2+n]</a>
              </template>
          </li>
          <li v-on:click="reload" class="disabled">
            <a style="width: 45px" href="javascript:void(0);">#[created_currentPage]</a>
          </li>
          <li v-if="created_currentPage < created_totalPage">
            <template v-for="n in 2">
                <a v-if="created_currentPage+n+1 <=created_totalPage" href="javascript:void(0);" page="#[created_currentPage+n+1]" style="width: 45px"
                   title="第#[created_currentPage+n+1]页" v-on:click="page_created" class="text-bold">#[created_currentPage+n+1]</a>
            </template>
          </li>
          <li v-if="created_currentPage+2 < created_totalPage">
            <a href="javascript:void(0);" page="#[created_totalPage]" v-on:click="page_created" title="第#[created_totalPage]页"
              class="text-bold">末页</a>
          </li>
        </ul>
        <div class="form-group">
            &nbsp;&nbsp;&nbsp;共 #[created_count] 条数据, 每页 #[created_perPage] 条, 第 #[created_currentPage]/#[created_totalPage] 页
        </div>
      </div>
      <br/>
    </div>

    <div class="tab-pane" id="pane-FINISHED">
      <table class="table table-hover" data-status="FINISHED">
        <thead>
        <tr>
          <th class="text-center hidden-sm hidden-xs" style="width:60px;">
            <input type="checkbox" name="checkboxAllRow" class="checkboxAllRow" v-on:click="toggleAllBox"/>
          </th>
          <th class="visible-sm visible-xs" id="show_all_detail" style="width:50px;" v-on:click="show_all_detail">
            <i class="fa fa-plus-square text-muted" aria-hidden="true"></i>
          </th>
          <th>Date</th>
          <th>Name</th>
          <th class="hidden-sm hidden-xs">Status</th>
          <th class="hidden-sm hidden-xs">Ship</th>
          <th>Sell</th>
          <th>Cost</th>
          <th>Profit</th>
          <th class="hidden-sm hidden-xs"></th>
        </tr>
        </thead>
        <tbody v-for="item in finished_items">
        <tr v-on:click="show_detail(item.id, $event)" data-pk="{!! item.id !!}">
          <td class="text-center hidden-sm hidden-xs">
            <input type="checkbox" class="minimal" name="checkboxRow" value="#[item.id]"/>
          </td>
          <td class="visible-sm visible-xs show_detail" data-pk="{!! item.id !!}">
            <i class="fa fa-plus-square text-primary" aria-hidden="true"></i>
          </td>
          <td>
            <a target="_blank" href="{!! item.detail_url !!}">{!! item.create_time !!}</a>
          </td>
          <td>
            <a href="{!! item.customer_url !!}">{!! item.customer_display !!}</a>
          </td>
          <td class="hidden-sm hidden-xs">
            <span class="label label-danger">{!! item.status !!}</span>
          </td>
          <td class="hidden-sm hidden-xs">
            {!! item.shipping_order !!}
          </td>
          <td>
            <a href="{!! item.edit_url !!}">{!! item.sell_price_rmb !!}</a>
          </td>
          <td>
            {!! item.total_cost_rmb !!}
          </td>
          <td>
            {!! item.profit_rmb !!}
          </td>
          <td class="text-right hidden-sm hidden-xs">
            {% if page_model_perms.change %}
              <a data-toggle="tooltip" data-placement="bottom" data-original-title="Edit" href="#[item.edit_url]"
                 class="btn btn-primary btn-sm">
                <i class="fa fa-lg fa-pencil fa-inverse"></i>
              </a>
            {% endif %}
            {% if page_model_perms.delete %}
              <a data-toggle="tooltip" data-placement="bottom" data-original-title="Delete" data-pk="#[item.id]"
                 v-on:click="removeOne" href="javascript:void(0);" class="btn btn-danger btn-sm">
                <i class="fa fa-lg fa-trash-o fa-inverse"></i>
              </a>
            {% endif %}
          </td>
        </tr>
        <tr class="hide" id="detail_{!! item.id !!}">
          <td colspan="3" class="hidden-sm hidden-xs"></td>
          <td colspan="100%">
            <div>{!! item.address_display !!}</div>
            <div class="pull-left">
              {!! item.product_summary !!}
            </div>
            <div class="pull-right visible-sm visible-xs">
              {!! item.shipping_order !!}
            </div>
          </td>
        </tr>
        </tbody>
        <tfoot>
        <tr>
        </tr>
        </tfoot>
      </table>

      <div class="form-inline" align="center">
        <ul class="pagination pagination-sm no-margin form-group">
          <li v-if="finished_currentPage > 1">
            <a v-if="finished_currentPage-2 > 1" href="javascript:void(0);" page="1" v-on:click="page_finished" title="第1页" class="text-bold">首页</a>
          </li>
          <li v-if="finished_currentPage > 1">
            <template v-for="n in 2">
                <a v-if="finished_currentPage-2+n > 0" href="javascript:void(0);" page="#[finished_currentPage-2+n]" style="width: 45px"
                   title="第#[finished_currentPage-2+n]页" v-on:click="page_finished" class="text-bold">#[finished_currentPage-2+n]</a>
            </template>
          </li>
          <li v-on:click="reload" class="disabled">
            <a style="width: 45px" href="javascript:void(0);" title="第#[finished_currentPage]页">#[finished_currentPage]</a>
          </li>
          <li v-if="finished_currentPage < finished_totalPage">
            <template v-for="n in 2">
                <a v-if="finished_currentPage+n+1 <=finished_totalPage" href="javascript:void(0);" page="#[finished_currentPage+n+1]" style="width: 45px"
                   title="第#[finished_currentPage+n+1]页" v-on:click="page_finished" class="text-bold">#[finished_currentPage+n+1]</a>
            </template>
          </li>
          <li v-if="finished_currentPage+2 < finished_totalPage">
            <a href="javascript:void(0);" page="#[finished_totalPage]" v-on:click="page_finished" title="第#[finished_totalPage]页"
               class="text-bold">末页</a>
          </li>
        </ul>
        <div class="form-group">
            &nbsp;&nbsp;&nbsp;共 #[finished_count] 条数据, 每页 #[finished_perPage] 条, 第 #[finished_currentPage]/#[finished_totalPage] 页
        </div>
      </div>
      <br/>
    </div>
  </div>
{% endblock %}

{% block common_list_pagination %}
    <div class="modal fade" id="add-product" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="X">
                        <span aria-hidden="true">×</span>
                    </button>
                    <h4 class="modal-title">添加产品</h4>
                </div>
                <div class="modal-body clearfix">
                    {% for field in orderproduct_form.visible_fields %}
                        <div class="form-group col-xs-12">
                            <label for="id_{{ field.name }}" class="ln34 col-sm-2 hidden-xs control-label">{{ field.label }}</label>
                            <div class="col-sm-7 col-xs-12">
                                {{ field }}
                            </div>
                            <div class="col-sm-3 hidden-xs">
                                {{ field.errors }}
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">取 消</button>
                    <button type="button" class="btn btn-primary continue">确定 & 继续</button>
                    <button type="button" class="btn btn-primary">确定 & 关闭</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>

    <div class="modal fade" id="add-parcel" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="X">
                        <span aria-hidden="true">×</span>
                    </button>
                    <h4 class="modal-title">添加包裹</h4>
                </div>
                <div class="modal-body clearfix">
                    {{ expressorder_form.order }}
                    {% for field in expressorder_form.visible_fields %}
                        {% ifnotequal field.name 'id_upload' %}
                        <div class="form-group col-xs-12">
                            <label for="id_{{ field.name }}" class="ln34 col-sm-2 hidden-xs control-label">{{ field.label }}</label>
                            <div class="col-sm-7 col-xs-12">
                                {{ field }}
                            </div>
                            <div class="col-sm-3 hidden-xs">
                                {{ field.errors }}
                            </div>
                        </div>
                        {% endifnotequal %}
                    {% endfor %}
                    <div class="form-group col-xs-12">
                        <label for="id_{{ expressorder_form.id_upload.name }}" class="ln34 col-sm-2 hidden-xs control-label">{{ expressorder_form.id_upload.label }}</label>
                        <div class="ln34 col-sm-7 col-xs-1">
                            {{ expressorder_form.id_upload }}
                        </div>
                        <div class="ln34 col-xs-10 visible-xs">
                            <label for="id_{{ expressorder_form.id_upload.name }}" class="visible-xs control-label">身份证已上传</label>
                        </div>
                        <div class="col-sm-3 hidden-xs">
                            {{ expressorder_form.id_upload.errors }}
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <p class="text-left">* 部分快递单号可自动识别物流公司</p>
                    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">取 消</button>
                    <button type="button" class="btn btn-primary continue">确定 & 继续</button>
                    <button type="button" class="btn btn-primary">确定 & 关闭</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
{% endblock %}

{% block common_list_footer_page_script %}
  {{ expressorder_form.media }}
  <script type="text/javascript" src="{% static 'js/order/order_list_base.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/order/order_list.js' %}"></script>
  <script src="{% static 'plugins/iCheck/icheck.min.js' %}"></script>
  <script>
      $(document).ready(function () {
        $('input').iCheck({
            checkboxClass: 'icheckbox_square-blue',
            radioClass: 'iradio_square-blue',
            increaseArea: '20%' // optional
        });
    });
  </script>

{% endblock %}